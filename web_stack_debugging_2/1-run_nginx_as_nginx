#!/usr/bin/env bash
# Configure Nginx to run as nginx user and listen on port 8080

# Stop any running nginx
pkill -9 nginx

# Configure nginx to run as nginx user
sed -i "s/#user www-data;/user nginx;/" /etc/nginx/nginx.conf
sed -i "s/user www-data;/user nginx;/" /etc/nginx/nginx.conf

# Change port from 80 to 8080
sed -i "s/listen 80;/listen 8080;/" /etc/nginx/sites-available/default
sed -i "s/listen \[::\]:80;/listen \[::\]:8080;/" /etc/nginx/sites-available/default

# Fix permissions
chown -R nginx:nginx /var/log/nginx
chown -R nginx:nginx /var/lib/nginx

# Start nginx as nginx user
su -s /bin/sh -c "/usr/sbin/nginx" nginx
