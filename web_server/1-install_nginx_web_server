#!/usr/bin/env bash
# Install Nginx, configure root page to 'Holberton School for the win!', ensure server listens on port 80

# Update package list
apt-get update -y

# Install Nginx without prompts
apt-get install -y nginx

# Ensure web root exists
mkdir -p /var/www/html

# Remove default Nginx index to avoid conflicts
rm -f /var/www/html/index.nginx-debian.html

# Create required index.html
echo "Holberton School for the win!" > /var/www/html/index.html

# Set ownership and permissions
chown -R www-data:www-data /var/www/html
chmod -R 755 /var/www/html

# Force Nginx default site config to use /var/www/html as root
sed -i 's|root /var/www/html;|root /var/www/html;|' /etc/nginx/sites-available/default
sed -i 's|index index.html index.htm index.nginx-debian.html;|index index.html;|' /etc/nginx/sites-available/default

# Test Nginx configuration syntax
nginx -t

# Reload Nginx safely (restart if not running)
service nginx stop
service nginx start

# Ensure Nginx is listening on port 80
netstat -tlnp | grep :80
